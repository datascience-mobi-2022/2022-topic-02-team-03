---
title: "metabolic Genesets"
author: "Marie Kleinert"
date: "10 5 2022"
output: html_document
---
Load all needed packages:

```{r, include = FALSE}
library(msigdbr)
library(pheatmap)
library(grid)
library(bayesbio)
genesets = readRDS("./data/hallmarks_genesets.rds")
```

Get human specific, canonical genesets from KEGG:
```{r}
canonical_pathways_KEGG = msigdbr(species = "human", category = "C2", subcategory = "CP:KEGG")
```

Filtering for all genesets related to metabolism:
```{r}
metabolism_pathways_KEGG = canonical_pathways_KEGG[which(grepl("METABOLISM", canonical_pathways_KEGG$gs_name)==TRUE),]
```

Creating a list with all characters for each pathway containing the human_gene_symbol of each related genes:
```{r}
metabolism_list = list()

for (gene.name in unique(metabolism_pathways_KEGG$gs_name))
  {pathway = c(metabolism_pathways_KEGG[metabolism_pathways_KEGG$gs_name == gene.name, 7])
  names(pathway) = substring(gene.name, 6)
  metabolism_list[substring(gene.name, 6)] = pathway}

metabolism_list

rm(gene.name, pathway)
```

Extracting the hallmark genesets from KEGG into a list:
```{r}
hallmark_pathways_KEGG = msigdbr(species = "human", category = "H")

hallmark_list = list()

for (gene.name in unique(hallmark_pathways_KEGG$gs_name))
  {pathway = c(hallmark_pathways_KEGG[hallmark_pathways_KEGG$gs_name == gene.name, 7])
  names(pathway) = substring(gene.name, 10)
  hallmark_list[substring(gene.name, 10)] = pathway}

hallmark_list

rm(gene.name, pathway)
```

Calculating the Jaccard Coefficients with our metabolism_genesets:
```{r}
Jaccard_coefficients_hallmark = matrix(ncol = length(hallmark_list), nrow = length(metabolism_list), byrow = TRUE)

for (i in 1:length(metabolism_list))
  {for (j in 1:length(hallmark_list))
    {j_value = jaccardSets(metabolism_list[[i]], hallmark_list[[j]])
    Jaccard_coefficients_hallmark[i, j] = j_value 
  }}

colnames(Jaccard_coefficients_hallmark) = names(hallmark_list)
rownames(Jaccard_coefficients_hallmark) = names(metabolism_list)

Jaccard_coefficients_hallmark

rm(i, j, j_value)
```

Visualizing the similarity using a heatmap:
```{r}
pheatmap(Jaccard_coefficients_hallmark, cluster_rows = FALSE, cluster_cols = FALSE, fontsize = 4, color = colorRampPalette(c("lightskyblue1", "firebrick"))(100), main = "Jaccard Coefficients of hallmark genesets and metabolism genesets")
```



-------------------------------------------------------------------------------------
Computing the Jaccard similarity for our list of gene sets "metabolism_list" and the given list of hallmark gene sets "hallmarks_genesets":

Creating a function that returns the Jaccard coefficient, considering that **Jaccard Similarity = (number of observations in both sets) / (number in either set)**
```{r}
jaccard = function(a, b) {                         #a und b sind Vektoren
    intersection = length(intersect(a, b))          #Schnittmenge
    union = length(a) + length(b) - intersection    #Vereinigungsmenge
    return (intersection/union)
}
```

Calculating the Jaccard-Coefficient for the metabolism genesets and the provided genesets of cancer hallmarks:
```{r}
Jaccard_coefficients = matrix(ncol = length(genesets[[1]]), nrow = length(metabolism_list), byrow = TRUE)
for (i in (1:length(metabolism_list))){
  for (j in (1:length(genesets[[1]]))){
       j_value = jaccard(metabolism_list[[i]], genesets[[1]][[j]])
    Jaccard_coefficients[i, j] = j_value 
  }}

colnames(Jaccard_coefficients) = names(genesets[[1]])
rownames(Jaccard_coefficients) = names(metabolism_list)

Jaccard_coefficients

rm(i, j, j_value)
```

Visualizing the similarity using a heatmap:
```{r}
setHook("grid.newpage", function() pushViewport(viewport(x=1,y=1,width=0.9, height=0.9, name="vp", just=c("right","top"))), action="prepend")

pheatmap(Jaccard_coefficients, cluster_rows = FALSE, cluster_cols = FALSE, fontsize = 5, color = colorRampPalette(c("lightskyblue1", "firebrick"))(100))
setHook("grid.newpage", NULL, "replace")
grid.text("hallmarks_genesets", y=1, x=0.3, gp = gpar(fontsize=8))
grid.text("metabolism_list", x=0, y=0.6, rot=90, gp = gpar(fontsize=8))
```


